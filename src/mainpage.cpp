#include "main.h"
#include "../include/IMAGE_PR.h"

void drawMainPage()
{
	// 初始化窗口
	initgraph(screenWidth, screenHeight);

	int viewportX = 0, viewportY = 0, MOVE_STEP = 10;
	int  MAP_WIDTH = screenWidth * 3, MAP_HEIGHT = screenHeight * 3;
	int  VIEW_WIDTH = screenWidth, VIEW_HEIGHT = screenHeight;
	// 加载图像
	IMAGE_PR gamebackground_img(_T(".\\resources\\images\\game_background.png"));
	gamebackground_img.ShowScalingImage(screenWidth * 3, screenHeight * 3, screenWidth * 3 / 2, screenHeight * 3 / 2);

	while (true) {
		if (_kbhit())
		{
			BeginBatchDraw();  // 开始双缓冲
			cleardevice();     // 清屏，防止画面残留
			char key = _getch();
			switch (key)
			{
			case 72: // ↑
				viewportY += MOVE_STEP;
				break;
			case 80: // ↓
				viewportY -= MOVE_STEP;
				break;
			case 75: // ←
				viewportX += MOVE_STEP;
				break;
			case 77: // → 
				viewportX -= MOVE_STEP;
				break;
			case 27: // ESC 退出
				closegraph();
			}
			// 开始双缓冲
			gamebackground_img.ShowScalingImage(screenWidth * 3, screenHeight * 3, screenWidth * 3 / 2 + viewportX, screenHeight * 3 / 2 + viewportY);
			EndBatchDraw(); // 结束双缓冲，刷新屏幕
		}
		/*Sleep(10);*/
	}
}

